(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1073:(e,t,r)=>{Promise.resolve().then(r.bind(r,7511))},7511:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var a=r(924),l=r(6144);let s=null,n=void 0!==globalThis.window;function i(e){var t,r;if(void 0!==e)return e.endsWith("/")?e:e+"/";if(!n)return"/";let a=null==(t=globalThis.document)?void 0:t.querySelector("base");if(null==a?void 0:a.href)try{let e=new URL(a.href,null==(r=globalThis.location)?void 0:r.href).pathname;return e.endsWith("/")?e:e+"/"}catch(e){}return"/"}async function o(e){if(n)return new Promise((t,r)=>{var a;let l=globalThis;if("function"==typeof(null==(a=l.window)?void 0:a.Module))return void t(l.window.Module);let s=i(e),n=l.document;if(!n)return void r(Error("document is not available"));let o=n.createElement("script");o.src=s+"unrar.js",o.onload=()=>{var e;"function"==typeof(null==(e=l.window)?void 0:e.Module)?t(l.window.Module):r(Error("unrar.js loaded but Module is not defined"))},o.onerror=()=>r(Error("Failed to load unrar.js")),n.head.appendChild(o)});{let{createRequire:e}=await r.e(484).then(r.t.bind(r,484,19));return e("file:///home/runner/work/unrar-browser-wasm/unrar-browser-wasm/packages/unrar-wasm/dist/index.js")("../build/unrar.js")}}async function c(e){return s||(s=(async()=>{let t=await o(e),r={};if(n){let t=i(e);r.locateFile=(e,r)=>{if(e.endsWith(".wasm")){let r=t+e;return console.log("[locateFile] WASM 文件路径:",r),r}return r+e}}let a=await t(r);return{Archive:a.Archive,CommandData:a.CommandData,setPassword:a.setPassword,FS:a.FS,HeaderType:{HEAD_FILE:a.FILE_HEAD_VALUE,HEAD_ENDARC:a.ENDARC_HEAD_VALUE},getFileDataPtr:a.getFileDataPtr,getFileDataSize:a.getFileDataSize}})()),s}function d(){return(0,a.jsx)("header",{className:"bg-white border-b border-gray-200",children:(0,a.jsx)("div",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"UnRAR Browser (Next.js Demo)"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:"Extract RAR files in your browser"})]}),(0,a.jsx)("a",{href:"https://github.com/DavidKk/unrar-browser-wasm",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-gray-600 hover:text-gray-900",children:"GitHub"})]})})})}function u(e){let{message:t,type:r,onClose:l}=e;return(0,a.jsxs)("div",{className:"p-3 border ".concat({info:"bg-blue-50 border-blue-300 text-blue-900",success:"bg-green-50 border-green-300 text-green-900",error:"bg-red-50 border-red-300 text-red-900"}[r]," flex items-center justify-between mb-4 text-sm"),children:[(0,a.jsx)("span",{className:"flex-1",children:t}),(0,a.jsx)("button",{onClick:l,className:"ml-4 text-current opacity-60 hover:opacity-100",children:"\xd7"})]})}function x(e){let{progress:t,message:r="Loading..."}=e;return(0,a.jsxs)("div",{className:"bg-white border border-gray-200 p-4 mb-4",children:[(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm mb-1",children:[(0,a.jsx)("span",{className:"text-gray-700",children:r}),(0,a.jsxs)("span",{className:"text-gray-500 font-mono",children:[Math.round(t),"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 h-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 transition-all duration-300",style:{width:"".concat(t,"%")}})})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Downloading WebAssembly module..."})]})}function m(e){let t="bigint"==typeof e?Number(e):e,r=["B","KB","MB","GB"],a=0,l=t;for(;l>=1024&&a<r.length-1;)l/=1024,a++;return"".concat(l.toFixed(2)," ").concat(r[a])}function h(e){let{selectedFile:t,isExtracting:r,moduleLoaded:s,onFileSelect:n,onExtract:i,onClear:o}=e,c=(0,l.useRef)(null),[d,u]=(0,l.useState)(!1);return(0,a.jsxs)("div",{className:"bg-white border border-gray-200 p-4 mb-4",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h2",{className:"text-base font-semibold text-gray-900 mb-1",children:"Select RAR File"}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Files stay in your browser, nothing is uploaded"})]}),t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"p-3 bg-gray-50 border border-gray-200 mb-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:t.name}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:m(t.size)})]}),(0,a.jsx)("button",{onClick:o,className:"text-gray-400 hover:text-gray-600 text-lg",children:"\xd7"})]})}),(0,a.jsx)("button",{onClick:i,disabled:!s||r,className:"w-full bg-blue-600 text-white font-medium py-2 px-4 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:r?"Extracting...":"Extract Files"})]}):(0,a.jsxs)("div",{onDrop:e=>{e.preventDefault(),u(!1);let t=e.dataTransfer.files[0];t&&t.name.endsWith(".rar")&&n(t)},onDragOver:e=>{e.preventDefault(),u(!0)},onDragLeave:()=>{u(!1)},className:"border-2 border-dashed p-8 text-center cursor-pointer ".concat(d?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-blue-400 hover:bg-gray-50"),onClick:()=>{var e;return null==(e=c.current)?void 0:e.click()},children:[(0,a.jsx)("input",{ref:c,type:"file",accept:".rar",className:"hidden",onChange:e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];r&&n(r)}}),(0,a.jsxs)("p",{className:"text-sm font-medium text-gray-700",children:["Drop RAR file here or ",(0,a.jsx)("span",{className:"text-blue-600",children:"browse"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:".rar files up to 100MB"})]})]})}function b(e){let{files:t}=e;return(0,a.jsxs)("div",{className:"bg-white border border-gray-200 p-4",children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Extracted Files"}),(0,a.jsx)("div",{className:"space-y-2",children:t.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 border border-gray-200 hover:bg-gray-100",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0 mr-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.name}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.isDirectory?"Directory":m(e.size)})]}),!e.isDirectory&&e.data&&(0,a.jsx)("button",{onClick:()=>(e=>{if(!e.data)return;let t=new Blob([e.data.slice()]),r=URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download=e.name,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)})(e),className:"px-3 py-1 bg-blue-600 text-white hover:bg-blue-700 text-xs font-medium",children:"Download"})]},t))})]})}function f(){return(0,a.jsx)("footer",{className:"bg-white border-t border-gray-200 mt-8",children:(0,a.jsxs)("div",{className:"px-6 py-6 text-center text-gray-500",children:[(0,a.jsxs)("p",{className:"text-xs mb-1",children:["Powered by"," ",(0,a.jsx)("a",{href:"https://www.rarlab.com/",className:"text-blue-600 hover:text-blue-700",children:"UnRAR"})," ","and"," ",(0,a.jsx)("a",{href:"https://webassembly.org/",className:"text-blue-600 hover:text-blue-700",children:"WebAssembly"})]}),(0,a.jsx)("p",{className:"text-xs",children:"All processing happens locally. Your files never leave your device."})]})})}function g(){let{module:e,loading:t,progress:r,error:s}=function(){let[e,t]=(0,l.useState)(null),[r,a]=(0,l.useState)(!0),[s,n]=(0,l.useState)(0),[i,o]=(0,l.useState)(null);return(0,l.useEffect)(()=>{let e=!0,r=null;return(async()=>{try{a(!0),n(0);let l=0;r=setInterval(()=>{l<90&&((l+=15*Math.random())>90&&(l=90),e&&n(l))},200);let s="/";{let e=window.location.pathname;if(console.log("[useUnrarModule] Current pathname:",e),e.includes("/nextjs-demo")){let t=e.match(/^(.*?\/nextjs-demo)/);t&&(s=t[1]+"/")}}console.log("[useUnrarModule] Using basePath:",s);let i=await c(s);r&&clearInterval(r),e&&(n(100),t(i),o(null))}catch(t){r&&clearInterval(r),e&&(o(t instanceof Error?t:Error(String(t))),n(0))}finally{e&&a(!1)}})(),()=>{e=!1,r&&clearInterval(r)}},[]),{module:e,loading:r,progress:s,error:i}}(),{extractedFiles:n,isExtracting:i,error:o,extract:m,clear:g}=function(e){let[t,r]=(0,l.useState)([]),[a,s]=(0,l.useState)(!1),[n,i]=(0,l.useState)(null),o=(0,l.useCallback)(async t=>{if(!e)throw Error("UnRAR module not loaded");let r=e.FS,a="/temp.rar";r.writeFile(a,new Uint8Array(t));let l=new e.CommandData,s=new e.Archive(l);if(!s.openFile(a))throw r.unlink(a),Error("Cannot open RAR file");if(!s.isArchive(!0))throw r.unlink(a),Error("Not a valid RAR file");let n=[];for(;s.readHeader()>0;){let t=s.getHeaderType();if(t===e.HeaderType.HEAD_FILE){let e=s.getFileName(),t=s.getFileSize(),r=s.isDirectory(),a=null;if(!r){let e=s.readFileData(),t=e.size();a=new Uint8Array(t);for(let r=0;r<t;r++)a[r]=e.get(r)}n.push({name:e,size:t,isDirectory:r,data:a})}else if(t===e.HeaderType.HEAD_ENDARC)break;s.seekToNext()}return r.unlink(a),n},[e]),c=(0,l.useCallback)(async t=>{if(e&&!a){s(!0),r([]),i(null);try{let e=await t.arrayBuffer(),a=await o(e);r(a)}catch(e){i(e instanceof Error?e:Error(String(e))),r([])}finally{s(!1)}}},[e,a,o]);return{extractedFiles:t,isExtracting:a,error:n,extract:c,clear:(0,l.useCallback)(()=>{r([]),i(null)},[])}}(e),[y,p]=(0,l.useState)(null),[w,j]=(0,l.useState)(null),v=(0,l.useCallback)((e,t)=>{p({message:e,type:t}),("success"===t||"info"===t)&&setTimeout(()=>p(null),5e3)},[]);(0,l.useEffect)(()=>{s?v("Failed to load UnRAR module: ".concat(s.message),"error"):e&&!t&&v("UnRAR module loaded successfully! Ready to extract files.","success")},[t,s,e,v]),(0,l.useEffect)(()=>{o?v("Extraction failed: ".concat(o.message),"error"):n.length>0&&v("Successfully extracted ".concat(n.length," file(s)!"),"success")},[o,n.length,v]);let N=async()=>{w&&(v("Extracting files...","info"),await m(w))};return(0,a.jsxs)("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[(0,a.jsx)(d,{}),(0,a.jsxs)("main",{className:"flex-1 max-w-4xl w-full mx-auto px-4 py-6",children:[t&&(0,a.jsx)(x,{progress:r,message:"Loading UnRAR WASM Module"}),y&&(0,a.jsx)(u,{message:y.message,type:y.type,onClose:()=>p(null)}),(0,a.jsx)(h,{selectedFile:w,isExtracting:i,moduleLoaded:!!e,onFileSelect:e=>{j(e),g()},onExtract:N,onClear:()=>{j(null),g()}}),n.length>0&&(0,a.jsx)(b,{files:n})]}),(0,a.jsx)(f,{})]})}}},e=>{e.O(0,[999,970,358],()=>e(e.s=1073)),_N_E=e.O()}]);